traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
testdata <- mlogit.data(test, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
which(!(levels(train$income) %in% levels(test$income)))
levels(train$income)[13]
train <- read.csv("train.csv")
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
test <- read.csv("test.csv")
which(!(levels(train$income) %in% levels(test$income)))
which(!(levels(test$income) %in% levels(train$income)))
N <- nrow(train)
levels(test$income)
N <- nrow(train)
for (i in 1:N){
if (as.character(test[i,93]) == "$290,000 to $299,999"){
test[i,93] = as.character("$270,000 to $279,999")
}
}
which(!(levels(train$income) %in% levels(test$income)))
which(!(levels(test$income) %in% levels(train$income)))
model6 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | income + segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
train <- read.csv("train.csv")
library(mlogit)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
train <- read.csv("train.csv")
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (as.character(train[i,93]) == "$290,000 to $299,999"){
train[i,93] = as.character("$270,000 to $279,999")
}
}
warning()
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (as.character(train[i,93]) == "$290,000 to $299,999"){
train[i,93] = as.character("$270,000 to $279,999")
}
}
library(mlogit)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
test <- read.csv("test.csv")
test[is.na(test)] <- 0
N <- nrow(test)
for (i in 1:N){
if (as.character(test[i,93]) == "$180,000 to $189,999"){
test[i,93] = as.character("$170,000 to $179,999")
} else if (as.character(test[i,93]) == "$230,000 to $239,999"){
test[i,93] = as.character("$220,000 to $229,999")
} else if (as.character(test[i,93]) == "$270,000 to $279,999"){
test[i,93] = as.character("$250,000 to $259,999")
}
}
testdata <- mlogit.data(test, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
testdata[is.na(testdata)] <- 0
model6 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | income + segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
AIC(model6) #22310.62, 22306.32(with massaged income)
str(train)
str(test)
grep("income", colnames(train))
which(train$income == factor("$290,000 to $299,999"))
which(train$income == "$290,000 to $299,999"\)
which(train$income == "$290,000 to $299,999")
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (as.character(train[i,93]) == "$290,000 to $299,999"){
train[i,93] = as.character("$270,000 to $279,999")
print (i)
}
}
warnings
warnings()
View(train)
as.character("$270,000 to $279,999")
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (as.character(train[i,93]) == "$290,000 to $299,999"){
train[i,93] <- as.character("$270,000 to $279,999")
print (i)
}
}
warnings()
factor(as.character("$270,000 to $279,999"))
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (as.character(train[i,93]) == "$290,000 to $299,999"){
train[i,93] <- factor(as.character("$270,000 to $279,999"))
print (i)
}
}
warnings()
train <- read.csv("train.csv")
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- factor(as.character("$270,000 to $279,999"))
print (i)
}
}
warnings()
train <- read.csv("train.csv"m stringsAsFactors = FALSE)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$270,000 to $279,999")
print (i)
}
}
str(train)
library(mlogit)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
str(traindata)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$270,000 to $279,999")
print (i)
}
}
train$segment <- factor(train$segment)
train$year <- factor(train$year)
train$miles <- factor(train$miles)
train$night <- factor(train$night)
train$gender <- factor(train$gender)
train$age <- factor(train$age)
train$educ <- factor(train$educ)
train$region <- factor(train$region)
train$Urb <- factor(train$Urb)
train$income <- factor(train$income)
train$ppark <- factor(train$ppark)
str(train)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
str(traindata)
test <- read.csv("test.csv")
test <- read.csv("test.csv", stringsAsFactors = FALSE)
test[is.na(test)] <- 0
N <- nrow(test)
for (i in 1:N){
if (as.character(test[i,93]) == "$180,000 to $189,999"){
test[i,93] = as.character("$170,000 to $179,999")
} else if (as.character(test[i,93]) == "$230,000 to $239,999"){
test[i,93] = as.character("$220,000 to $229,999")
} else if (as.character(test[i,93]) == "$270,000 to $279,999"){
test[i,93] = as.character("$250,000 to $259,999")
}
}
str(test)
test$segment <- factor(test$segment)
test$year <- factor(test$year)
test$miles <- factor(test$miles)
test$night <- factor(test$night)
test$gender <- factor(test$gender)
test$age <- factor(test$age)
test$educ <- factor(test$educ)
test$region <- factor(test$region)
test$Urb <- factor(test$Urb)
test$income <- factor(test$income)
test$ppark <- factor(test$ppark)
str(test)
testdata <- mlogit.data(test, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
model6 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | income + segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
predmlogit6 <- predict(model6, newdata = testdata)
which(!(levels(testdata$income) %in% levels(traindata$income)))
which(!(levels(test$income) %in% levels(train$income)))
which(!(levels(train$income) %in% levels(test$income)))
levels(train$income)[13]
levels(test$income)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$300,000 & Over")
}
}
train$segment <- factor(train$segment)
train$year <- factor(train$year)
train$miles <- factor(train$miles)
train$night <- factor(train$night)
train$gender <- factor(train$gender)
train$age <- factor(train$age)
train$educ <- factor(train$educ)
train$region <- factor(train$region)
train$Urb <- factor(train$Urb)
train$income <- factor(train$income)
train$ppark <- factor(train$ppark)
str(train)
model6 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | income + segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
predmlogit6 <- predict(model6, newdata = testdata)
which(!(levels(train$income) %in% levels(test$income)))
which(!(levels(test$income) %in% levels(train$income)))
str(testdata)
predmlogit6 <- predict(model1, newdata = testdata)
model1 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata)
predmlogit6 <- predict(model1, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
model2 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price, reflevel = "Ch1", data = traindata)
predmlogit6 <- predict(model2, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
summary(model1)
model9 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata)
summary(model9)
AIC(model9) #23645.76, logloss: 1.646171
model10 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FP
AIC(model10) #23645.76, logloss: 1.646171
model11 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FA
AIC(model11) #23645.12, logloss: 1.646171
model12 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without RP
AIC(model12) #23645.12, logloss: 1.646171
predmlogit6 <- predict(model9, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
predmlogit6 <- predict(model10, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
model11 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FA
AIC(model11) #23646.66, logloss: 1.646171
predmlogit6 <- predict(model11, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
model12 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without RP
predmlogit6 <- predict(model12, newdata = testdata)
predmlogit2_log <- log(predmlogit6)
logloss2 <- -(sum(predmlogit2_log*train[,95:98]))/N
logloss2 #0.3371199
summary(model10)
library(C50)
C50model1 <- C5.0(as.factor(Choice) ~ ., data = traindatanew)
testdatanew <- subset(testdata, select = - c(1,2,3,15,16,17,18,20,41))
traindatanew <- subset(traindata, select = - c(1,2,3,15,16,17,18,20,41))
library(C50)
C50model1 <- C5.0(as.factor(Choice) ~ ., data = traindatanew)
C5imp(C50model1)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1 | income + segment + region + night + ppark + educ + age + miles, data = traindata) #without FP
summary(modelX)
AIC(modelX)
predmlogitX <- predict(modelX, newdata = testdata)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1 | segment + region + night + ppark + educ + age + miles, data = traindata) #without FP
predmlogitX <- predict(modelX, newdata = testdata)
N <- nrow(testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
summary(modelX)
str(test)
C5imp(C50model1)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1 | segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
?mlogit
lrtest(modelX)
model7 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
lrtest(modelX, model7)
lrtest(model7, modelX)
predmlogitX <- predict(modelX, newdata = testdata)
N <- nrow(testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
AIC(modelX) #22371.91, logloss: 0.3377338
AIC(model7) #22371.91, logloss: 0.3377338
levels(test$income)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$300,000 & Over")
}
}
train$segment <- factor(train$segment)
train$year <- factor(train$year)
train$miles <- factor(train$miles)
train$night <- factor(train$night)
train$gender <- factor(train$gender)
train$age <- factor(train$age)
train$educ <- factor(train$educ)
train$region <- factor(train$region)
train$Urb <- factor(train$Urb)
train$income <- factor(train$income)
train$ppark <- factor(train$ppark)
train$income <- ifelse(train$income == "Under $29,999", 15000, ifelse(train$income == "$30,000 to $39,999", 35000, ifelse(train$income =="$40,000 to $49,999", 45000, ifelse(train$income =="$50,000 to $59,999", 55000, ifelse(train$income =="$60,000 to $69,999", 65000, ifelse(train$income =="$70,000 to $79,999", 75000, ifelse(train$income =="$80,000 to $89,999", 85000, ifelse(train$income =="$90,000 to $99,999", 95000, ifelse(train$income =="$100,000 to $109,999", 105000, ifelse(train$income == "$110,000 to $119,999", 115000, ifelse(train$income == "$120,000 to $129,999", 125000, ifelse(train$income == "$130,000 to $139,999", 135000, ifelse(train$income == "$140,000 to $149,999", 145000, ifelse(train$income == "$150,000 to $159,999", 155000, ifelse(train$income == "$160,000 to $169,999", 165000, ifelse(train$income == "$170,000 to $179,999", 175000, ifelse(train$income == "$190,000 to $199,999", 195000, ifelse(train$income == "$200,000 to $209,999", 205000, ifelse(train$income == "$220,000 to $229,999", 225000, ifelse(train$income == "$250,000 to $259,999", 255000, ifelse(train$income == "$300,000 & Over", 320000, 1000)))))))))))))))))))))
str(train)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$300,000 & Over")
}
}
train$segment <- factor(train$segment)
train$year <- factor(train$year)
train$miles <- factor(train$miles)
train$night <- factor(train$night)
train$gender <- factor(train$gender)
train$age <- factor(train$age)
train$educ <- factor(train$educ)
train$region <- factor(train$region)
train$Urb <- factor(train$Urb)
train$ppark <- factor(train$ppark)
train$income <- ifelse(train$income == "Under $29,999", 15000, ifelse(train$income == "$30,000 to $39,999", 35000, ifelse(train$income =="$40,000 to $49,999", 45000, ifelse(train$income =="$50,000 to $59,999", 55000, ifelse(train$income =="$60,000 to $69,999", 65000, ifelse(train$income =="$70,000 to $79,999", 75000, ifelse(train$income =="$80,000 to $89,999", 85000, ifelse(train$income =="$90,000 to $99,999", 95000, ifelse(train$income =="$100,000 to $109,999", 105000, ifelse(train$income == "$110,000 to $119,999", 115000, ifelse(train$income == "$120,000 to $129,999", 125000, ifelse(train$income == "$130,000 to $139,999", 135000, ifelse(train$income == "$140,000 to $149,999", 145000, ifelse(train$income == "$150,000 to $159,999", 155000, ifelse(train$income == "$160,000 to $169,999", 165000, ifelse(train$income == "$170,000 to $179,999", 175000, ifelse(train$income == "$190,000 to $199,999", 195000, ifelse(train$income == "$200,000 to $209,999", 205000, ifelse(train$income == "$220,000 to $229,999", 225000, ifelse(train$income == "$250,000 to $259,999", 255000, ifelse(train$income == "$300,000 & Over", 320000, 1000)))))))))))))))))))))
str(train)
str(train$income)
levels(train$income)
train$income)
train$income
library(mlogit)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
test <- read.csv("test.csv", stringsAsFactors = FALSE)
test[is.na(test)] <- 0
N <- nrow(test)
for (i in 1:N){
if (as.character(test[i,93]) == "$180,000 to $189,999"){
test[i,93] = as.character("$170,000 to $179,999")
} else if (as.character(test[i,93]) == "$230,000 to $239,999"){
test[i,93] = as.character("$220,000 to $229,999")
} else if (as.character(test[i,93]) == "$270,000 to $279,999"){
test[i,93] = as.character("$250,000 to $259,999")
}
}
test$income <- ifelse(test$income == "Under $29,999", 15000, ifelse(test$income == "$30,000 to $39,999", 35000, ifelse(test$income =="$40,000 to $49,999", 45000, ifelse(test$income =="$50,000 to $59,999", 55000, ifelse(test$income =="$60,000 to $69,999", 65000, ifelse(test$income =="$70,000 to $79,999", 75000, ifelse(test$income =="$80,000 to $89,999", 85000, ifelse(test$income =="$90,000 to $99,999", 95000, ifelse(test$income =="$100,000 to $109,999", 105000, ifelse(test$income == "$110,000 to $119,999", 115000, ifelse(test$income == "$120,000 to $129,999", 125000, ifelse(test$income == "$130,000 to $139,999", 135000, ifelse(test$income == "$140,000 to $149,999", 145000, ifelse(test$income == "$150,000 to $159,999", 155000, ifelse(test$income == "$160,000 to $169,999", 165000, ifelse(test$income == "$170,000 to $179,999", 175000, ifelse(test$income == "$190,000 to $199,999", 195000, ifelse(test$income == "$200,000 to $209,999", 205000, ifelse(test$income == "$220,000 to $229,999", 225000, ifelse(test$income == "$250,000 to $259,999", 255000, ifelse(test$income == "$300,000 & Over", 320000, 1000)))))))))))))))))))))
test$segment <- factor(test$segment)
test$year <- factor(test$year)
test$miles <- factor(test$miles)
test$night <- factor(test$night)
test$gender <- factor(test$gender)
test$age <- factor(test$age)
test$educ <- factor(test$educ)
test$region <- factor(test$region)
test$Urb <- factor(test$Urb)
test$ppark <- factor(test$ppark)
testdata <- mlogit.data(test, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
testdata[is.na(testdata)] <- 0
testdatanew <- subset(testdata, select = - c(1,2,3,15,16,17,18,20,41))
model1 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata)
AIC(model1) #23645.76, logloss: 1.646171
model7 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price | segment + educ + miles + age + region + Urb + ppark + night, data = traindata)
AIC(model7) #22365.67
predmlogit1 <- predict(model7, newdata = testdata)
N <- nrow(testdata)
predmlogit1_log <- log(predmlogit1)
logloss1<- -(sum(predmlogit1_log*train[,95:98]))/N
logloss1 #0.3371199
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1 | income + segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price*income)-1 | segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
which(traindata$income==0)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price*income)-1 | segment + region + night + ppark + educ + age + miles + Urb + gender, data = traindata) #without FP
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price*income) | segment + region + night + ppark + educ + age + miles + Urb + gender, data = traindata) #without FP
str(test)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1 | as.integer(income) + segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
leaps::leaps()
?leaps
modelX <- mlogit(Choice ~ income + segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
modelX <- mlogit(Choice ~ 0 | income + segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
summary(modelX)
remove(modelX)
modelX <- mlogit(Choice ~ 0 | segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
summary(modelX)
modelX <- mlogit(Choice ~ 0 | segment + region + night + ppark + I(income*educ) + age + miles + Urb + year + gender, data = traindata) #without FP
traindatanew <- subset(traindata, select = - c(1,2,3,15,16,17,18,20,41))
C50model1 <- C5.0(as.factor(Choice) ~ ., data = traindatanew)
C5imp(C50model1)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income) | segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
summary(modelX)
AIC(modelX) #22399.64, logloss: 0.3377338
predmlogitX <- predict(modelX, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
View(test)
train <- read.csv("train.csv", stringsAsFactors = FALSE)
N <- nrow(train)
for (i in 1:N){
if (train[i,93] == "$290,000 to $299,999"){
train[i,93] <- as.character("$300,000 & Over")
}
}
train$income <- ifelse(train$income == "Under $29,999", 15000, ifelse(train$income == "$30,000 to $39,999", 35000, ifelse(train$income =="$40,000 to $49,999", 45000, ifelse(train$income =="$50,000 to $59,999", 55000, ifelse(train$income =="$60,000 to $69,999", 65000, ifelse(train$income =="$70,000 to $79,999", 75000, ifelse(train$income =="$80,000 to $89,999", 85000, ifelse(train$income =="$90,000 to $99,999", 95000, ifelse(train$income =="$100,000 to $109,999", 105000, ifelse(train$income == "$110,000 to $119,999", 115000, ifelse(train$income == "$120,000 to $129,999", 125000, ifelse(train$income == "$130,000 to $139,999", 135000, ifelse(train$income == "$140,000 to $149,999", 145000, ifelse(train$income == "$150,000 to $159,999", 155000, ifelse(train$income == "$160,000 to $169,999", 165000, ifelse(train$income == "$170,000 to $179,999", 175000, ifelse(train$income == "$190,000 to $199,999", 195000, ifelse(train$income == "$200,000 to $209,999", 205000, ifelse(train$income == "$220,000 to $229,999", 225000, ifelse(train$income == "$250,000 to $259,999", 255000, ifelse(train$income == "$300,000 & Over", 320000, NA)))))))))))))))))))))
train$segment <- factor(train$segment)
train$year <- factor(train$year)
train$miles <- factor(train$miles)
train$night <- factor(train$night)
train$gender <- factor(train$gender)
train$age <- factor(train$age)
train$educ <- factor(train$educ)
train$region <- factor(train$region)
train$Urb <- factor(train$Urb)
train$ppark <- factor(train$ppark)
traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")
test <- read.csv("test.csv", stringsAsFactors = FALSE)
test[is.na(test)] <- 0
N <- nrow(test)
for (i in 1:N){
if (as.character(test[i,93]) == "$180,000 to $189,999"){
test[i,93] = as.character("$170,000 to $179,999")
} else if (as.character(test[i,93]) == "$230,000 to $239,999"){
test[i,93] = as.character("$220,000 to $229,999")
} else if (as.character(test[i,93]) == "$270,000 to $279,999"){
test[i,93] = as.character("$250,000 to $259,999")
}
}
test$income <- ifelse(test$income == "Under $29,999", 15000, ifelse(test$income == "$30,000 to $39,999", 35000, ifelse(test$income =="$40,000 to $49,999", 45000, ifelse(test$income =="$50,000 to $59,999", 55000, ifelse(test$income =="$60,000 to $69,999", 65000, ifelse(test$income =="$70,000 to $79,999", 75000, ifelse(test$income =="$80,000 to $89,999", 85000, ifelse(test$income =="$90,000 to $99,999", 95000, ifelse(test$income =="$100,000 to $109,999", 105000, ifelse(test$income == "$110,000 to $119,999", 115000, ifelse(test$income == "$120,000 to $129,999", 125000, ifelse(test$income == "$130,000 to $139,999", 135000, ifelse(test$income == "$140,000 to $149,999", 145000, ifelse(test$income == "$150,000 to $159,999", 155000, ifelse(test$income == "$160,000 to $169,999", 165000, ifelse(test$income == "$170,000 to $179,999", 175000, ifelse(test$income == "$190,000 to $199,999", 195000, ifelse(test$income == "$200,000 to $209,999", 205000, ifelse(test$income == "$220,000 to $229,999", 225000, ifelse(test$income == "$250,000 to $259,999", 255000, ifelse(test$income == "$300,000 & Over", 320000, NA)))))))))))))))))))))
test$segment <- factor(test$segment)
test$year <- factor(test$year)
test$miles <- factor(test$miles)
test$night <- factor(test$night)
test$gender <- factor(test$gender)
test$age <- factor(test$age)
test$educ <- factor(test$educ)
test$region <- factor(test$region)
test$Urb <- factor(test$Urb)
test$ppark <- factor(test$ppark)
str(test)
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income) | segment + region + night + ppark + educ + age + miles + Urb + year + gender, data = traindata) #without FP
AIC(modelX) #22399.64, logloss: 0.3236172
predmlogitX <- predict(modelX, newdata = testdata)
head(predmlogitX)
sum(predmlogitX[1,])
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
N <- nrow(testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
N <- nrow(test)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
model12 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without RP
predmlogitX <- predict(model12, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
N <- nrow(testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income), data = traindata) #without FP
predmlogitX <- predict(modelX, newdata = testdata)
N <- nrow(testdata)
N <- nrow(test)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
modelX <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1, data = traindata) #without FP
predmlogitX <- predict(modelX, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
summary(model1)
model9 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FA, RP, FP
predmlogitX <- predict(model9, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
model10 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FP
predmlogitX <- predict(model10, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
model11 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FA
model11 <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata) #without FA
predmlogitX <- predict(model11, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
predmlogit1 <- predict(model7, newdata = testdata)
N <- nrow(test)
predmlogit1_log <- log(predmlogit1)
logloss1<- -(sum(predmlogit1_log*train[,95:98]))/N
logloss1 #0.3371199
modelX <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1, data = traindata) #without FP, RP, FA
predmlogitX <- predict(modelX, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
model1 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price-1, data = traindata)
predmlogitX <- predict(model1, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
modelX <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1, data = traindata) #without FP, RP, FA
predmlogitX <- predict(modelX, newdata = testdata)
AIC(model7) #22365.67
summary(model7)
model6 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price, data = traindata)
predmlogitX <- predict(model6, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
model2 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price, reflevel = "Ch1", data = traindata)
predmlogitX <- predict(model2, newdata = testdata)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
modelX <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1 | income + segment + educ + miles + age + region + Urb + ppark + night + gender + year, data = traindata) #without FP, RP, FA
modelX <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1 | income + segment + educ + miles + age + region + Urb + ppark + night + gender + year, data = traindata) #without FP, RP, FA
modelX <- mlogit(Choice ~ CC+GN+NS+BU+LD+BZ+FC+PP+KA+SC+TS+NV+MA+LB+AF+HU+I(Price/income)-1 | segment + educ + miles + age + region + Urb + ppark + night + gender + year, data = traindata) #without FP, RP, FA
predmlogitX <- predict(modelX, newdata = testdata)
N <- nrow(test)
predmlogit_log <- log(predmlogitX)
logloss <- -(sum(predmlogit_log*train[,95:98]))/N
logloss
