---
title: "kaggle_car choices"
output: html_document
---
setwd("/Users/fendylieanata/Dropbox/ESD_Term 8/40.220 Analytics Edge/kaggle")
```{r}
#git add ., git commit -m "msg", git push, git pull
train <- read.csv("train.csv")
test <- read.csv("test.csv")

library(mlogit)

traindata <- mlogit.data(train, shape = "wide", choice = "Choice", varying = c(4:83), sep = "", alt.levels = c("Ch1","Ch2","Ch3","Ch4"), id.var = "Case")

str(traindata)

grep("Ch1", colnames(traindata))
grep("Ch2", colnames(traindata))
grep("Ch3", colnames(traindata))
grep("Ch4", colnames(traindata))
grep("chid", colnames(traindata))
grep("alt", colnames(traindata))

traindatanew <- subset(traindata, select = - c(1,2,3,15,16,17,18,20,41))

str(traindatanew)

traindatanew$CC <- factor(traindatanew$CC)
traindatanew$GN <- factor(traindatanew$GN)
traindatanew$NS <- factor(traindatanew$NS)
traindatanew$BU <- factor(traindatanew$BU)
traindatanew$FA <- factor(traindatanew$FA)
traindatanew$LD <- factor(traindatanew$LD)
traindatanew$BZ <- factor(traindatanew$BZ)
traindatanew$FC <- factor(traindatanew$FC)
traindatanew$FP <- factor(traindatanew$FP)
traindatanew$RP <- factor(traindatanew$RP)
traindatanew$PP <- factor(traindatanew$PP)
traindatanew$KA <- factor(traindatanew$KA)
traindatanew$SC <- factor(traindatanew$SC)
traindatanew$TS <- factor(traindatanew$TS)
traindatanew$NV <- factor(traindatanew$NV)
traindatanew$MA <- factor(traindatanew$MA)
traindatanew$LB <- factor(traindatanew$LB)
traindatanew$AF <- factor(traindatanew$AF)
traindatanew$HU <- factor(traindatanew$HU)
traindatanew$Price <- factor(traindatanew$Price)
traindatanew$year <- factor(traindatanew$year)
traindatanew$Choice <- factor(ifelse(traindatanew$Choice == TRUE, 1, 0))
str(traindatanew)
```

```{r}
# initialise everything
model1 <- mlogit(Choice ~ CC+GN+NS+BU+FA+LD+BZ+FC+FP+RP+PP+KA+SC+TS+NV+MA+LB+AF+HU+Price, data = traindata)
summary(model1)
original <- train$Choice
head(original)

pred1 <- predict(model1, newdata = traindata)
nrow(traindata)
nrow(testdata)

hist(train$GN1)
N <- nrow(train)
predictmodel1<-fitted(model1)
predictmodel1_log <- log(predictmodel1)
logloss1<- -(sum(predictmodel1_log*train[,95:98]))/N
logloss1

predictmodel2 <- model1$fitted.values
predictmodel2_log <- log(predictmodel2)
logloss2<- -(sum(predictmodel2_log*train[,95:98]))/N
logloss2
```

### C5.0
```{r}
library(C50)
C50model1 <- C5.0(Choice ~ ., data = traindatanew)
C5imp(C50model1)
predC50 <- predict.C5.0(C50model1, newdata = traindatanew, type = "prob")
N <- nrow(train)
predC50Matrix<-matrix(predC50[,2],nrow=N,ncol=4,byrow=TRUE)
predC50Matrix_log <- log(predC50Matrix)
logloss<- -(sum(predC50Matrix_log*train[,95:98]))/N
logloss

C50model2 <- C5.0(Choice ~ ., data = traindatanew, control = C5.0Control(winnow = TRUE))
predC50 <- predict.C5.0(C50model2, newdata = traindatanew, type = "prob")
N <- nrow(train)
predC50Matrix<-matrix(predC50[,2],nrow=N,ncol=4,byrow=TRUE)
predC50Matrix_log <- log(predC50Matrix)
logloss<- -(sum(predC50Matrix_log*train[,95:98]))/N
logloss
```

### Random Forest
```{r}
library(randomForest)

```

